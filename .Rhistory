unnest(px) %>%
group_by(ticker) %>%
mutate(return = adjusted/lag(adjusted) - 1) %>%
na.omit() %>%
ungroup() %>%
rowwise() %>%
mutate(contr_to_return = weight*return) %>%
group_by(date) %>%
summarize(daily_ret = sum(contr_to_return,na.rm=T)) %>%
mutate(cumulative_ret = with_order(date,cumprod,1+daily_ret)-1) %>%
plot_ly(
x = ~date,
y = ~cumulative_ret
) %>%
add_lines() %>%
add_bars(y = ~daily_ret,
yaxis = "y2") %>%
plotly_elegant(
)
px %>%
unnest(px) %>%
group_by(ticker) %>%
mutate(return = adjusted/lag(adjusted) - 1) %>%
na.omit() %>%
ungroup() %>%
rowwise() %>%
mutate(contr_to_return = weight*return) %>%
group_by(date) %>%
summarize(daily_ret = sum(contr_to_return,na.rm=T)) %>%
mutate(cumulative_ret = with_order(date,cumprod,1+daily_ret)-1) %>%
plot_ly(
x = ~date,
y = ~cumulative_ret
) %>%
add_lines() %>%
add_bars(y = ~daily_ret,
yaxis = "y2") %>%
plotly_elegant(
yaxis2 = list(overlaying = "y",side = "right")
)
add_returns <- function(px){
px %>%
group_by(ticker) %>%
mutate(return = adjusted/lag(adjusted) - 1) %>%
na.omit() %>%
ungroup()
}
px %>%
unnest(px) %>%
add_returns() %>%
rowwise() %>%
mutate(contr_to_return = weight*return) %>%
group_by(date) %>%
summarize(daily_ret = sum(contr_to_return,na.rm=T)) %>%
mutate(cumulative_ret = with_order(date,cumprod,1+daily_ret)-1) %>%
plot_ly(
x = ~date,
y = ~cumulative_ret
) %>%
add_lines() %>%
add_bars(y = ~daily_ret,
yaxis = "y2") %>%
plotly_elegant(
yaxis2 = list(overlaying = "y",side = "right")
)
tq_get("SPY") %>%
add_returns() %>%
mutate(cumulative_return = with_order(date,cumprod,1+daily_ret)-1)
add_returns <- function(px){
px %>%
group_by(any(ticker,symbol)) %>%
mutate(return = adjusted/lag(adjusted) - 1) %>%
na.omit() %>%
ungroup()
}
px %>%
unnest(px) %>%
add_returns() %>%
rowwise() %>%
mutate(contr_to_return = weight*return) %>%
group_by(date) %>%
summarize(daily_ret = sum(contr_to_return,na.rm=T)) %>%
mutate(cumulative_ret = with_order(date,cumprod,1+daily_ret)-1) %>%
plot_ly(
x = ~date,
y = ~cumulative_ret
) %>%
add_lines() %>%
add_bars(y = ~daily_ret,
yaxis = "y2") %>%
plotly_elegant(
yaxis2 = list(overlaying = "y",side = "right")
)
tq_get("SPY") %>%
add_returns() %>%
mutate(cumulative_return = with_order(date,cumprod,1+daily_ret)-1)
add_returns <- function(px){
px %>%
group_by(any_of(ticker,symbol)) %>%
mutate(return = adjusted/lag(adjusted) - 1) %>%
na.omit() %>%
ungroup()
}
px %>%
unnest(px) %>%
add_returns() %>%
rowwise() %>%
mutate(contr_to_return = weight*return) %>%
group_by(date) %>%
summarize(daily_ret = sum(contr_to_return,na.rm=T)) %>%
mutate(cumulative_ret = with_order(date,cumprod,1+daily_ret)-1) %>%
plot_ly(
x = ~date,
y = ~cumulative_ret
) %>%
add_lines() %>%
add_bars(y = ~daily_ret,
yaxis = "y2") %>%
plotly_elegant(
yaxis2 = list(overlaying = "y",side = "right")
)
add_returns <- function(px){
px %>%
group_by(any_vars(ticker,symbol)) %>%
mutate(return = adjusted/lag(adjusted) - 1) %>%
na.omit() %>%
ungroup()
}
px %>%
unnest(px) %>%
add_returns() %>%
rowwise() %>%
mutate(contr_to_return = weight*return) %>%
group_by(date) %>%
summarize(daily_ret = sum(contr_to_return,na.rm=T)) %>%
mutate(cumulative_ret = with_order(date,cumprod,1+daily_ret)-1) %>%
plot_ly(
x = ~date,
y = ~cumulative_ret
) %>%
add_lines() %>%
add_bars(y = ~daily_ret,
yaxis = "y2") %>%
plotly_elegant(
yaxis2 = list(overlaying = "y",side = "right")
)
add_returns <- function(px){
px %>%
group_by(symbol) %>%
mutate(return = adjusted/lag(adjusted) - 1) %>%
na.omit() %>%
ungroup()
}
px %>%
unnest(px) %>%
add_returns() %>%
rowwise() %>%
mutate(contr_to_return = weight*return) %>%
group_by(date) %>%
summarize(daily_ret = sum(contr_to_return,na.rm=T)) %>%
mutate(cumulative_ret = with_order(date,cumprod,1+daily_ret)-1) %>%
plot_ly(
x = ~date,
y = ~cumulative_ret
) %>%
add_lines() %>%
add_bars(y = ~daily_ret,
yaxis = "y2") %>%
plotly_elegant(
yaxis2 = list(overlaying = "y",side = "right")
)
tq_get("SPY") %>%
add_returns() %>%
mutate(cumulative_return = with_order(date,cumprod,1+daily_ret)-1)
tq_get("SPY") %>%
add_returns() %>%
mutate(cumulative_return = with_order(date,cumprod,1+return)-1)
tq_get("SPY") %>%
add_returns() %>%
mutate(cumulative_return = with_order(date,cumprod,1+return)-1) %>%
select(date,spy = cumulative_return)
bench <- tq_get("SPY") %>%
add_returns() %>%
mutate(cumulative_return = with_order(date,cumprod,1+return)-1) %>%
select(date,spy = cumulative_return)
px %>%
unnest(px) %>%
add_returns() %>%
rowwise() %>%
mutate(contr_to_return = weight*return) %>%
group_by(date) %>%
summarize(daily_ret = sum(contr_to_return,na.rm=T)) %>%
mutate(cumulative_ret = with_order(date,cumprod,1+daily_ret)-1) %>%
left_join(bench)
px %>%
unnest(px) %>%
add_returns() %>%
rowwise() %>%
mutate(contr_to_return = weight*return) %>%
group_by(date) %>%
summarize(daily_ret = sum(contr_to_return,na.rm=T)) %>%
mutate(cumulative_ret = with_order(date,cumprod,1+daily_ret)-1) %>%
left_join(bench) %>%
plot_ly(
x = ~date,
y = ~cumulative_ret
) %>%
add_lines(name = "all weather") %>%
add_lines(y = ~spy,name = "bench") %>%
add_bars(y = ~daily_ret,
yaxis = "y2",
name = "all weather daily") %>%
plotly_elegant(
yaxis2 = list(overlaying = "y",side = "right")
)
here("...")
here::here("inst","rmd","h","default.html")
input <- c(0.5, 0.8, 0.9, 0.97, 1)
output <- c(0,1,2,3,4)
df <- data.frame(cbind(input, output)
)
df
seq(0,1,rpois(1))
rpois(1,lambda = 0.5)
0.0:0.05
sample(1:100)/100
sample(1:100,1)/100
seq(0,1,sample(1:100,1)/100)
seq(0,20,sample(1:100,1)/100)
seq(0,20,.73)
# generate random bins
seq(0,20,.55)
# generate random bins
bins <- seq(0,20,.55)
value <- seq(0,20,1)
bins
value
df
tibble(
input = c(0.5, 0.8, 0.9, 0.97, 1),
output= c(0,1,2,3,4)
)
tibble(
input = c(0.5, 0.8, 0.9, 0.97, 1),
output= c(0,1,2,3,4)
)
tibble(
input = c(0.5, 0.8, 0.9, 0.97, 1),
output= c(0,1,2,3,4)
)
tibble(
input = c(0.5, 0.8, 0.9, 0.97, 1),
output= c(0,1,2,3,4)
) %>%
rowid_to_column("key")
tibble(
input = c(0.5, 0.8, 0.9, 0.97, 1),
output= c(0,1,2,3,4)
) %>%
rowid_to_column("key") %>%
left_join(
tibble(
rowid = nrow(.) + 1
)
)
df <- tibble(
input = c(0.5, 0.8, 0.9, 0.97, 1),
output= c(0,1,2,3,4)
)
my_match <- function(df,n){
df %>%
rowid_to_column("key") %>%
left_join(
tibble(
key = nrow(.) + 1,
input = n
)
)
}
df %>%
my_match(0.5)
my_match <- function(df,n){
df %>%
rowid_to_column("key") %>%
full_join(
tibble(
key = nrow(.) + 1,
input = n
)
)
}
df %>%
my_match(0.5)
df %>%
my_match(0.5) %>%
arrange(input)
df %>%
my_match(0.5) %>%
arrange(input) %>%
fill(output,.direction = "down")
df %>%
my_match(0.49) %>%
arrange(input) %>%
fill(output,.direction = "down")
df %>%
my_match(0.49) %>%
arrange(input) %>%
fill(output,.direction = "downup")
my_match <- function(df,n){
match_df <- df %>%
rowid_to_column("key")
new_key <- nrow(match_df) + 1
match_df %>%
full_join(
tibble(
key = new_key,
input = n
)
) %>%
arrange(input) %>%
fill(output,.direction = "downup") %>%
filter(key == new_key) %>%
pull(output)
}
df %>%
my_match(0.49)
my_match <- function(df,n){
match_df <- df %>%
rowid_to_column("key")
new_key <- nrow(match_df) + 1
match_df %>%
full_join(
tibble(
key = new_key,
input = n
),
by = c("key","input")
) %>%
arrange(input) %>%
fill(output,.direction = "downup") %>%
filter(key == new_key) %>%
pull(output)
}
df %>%
my_match(0.49)
df %>%
my_match(0.5)
df %>%
my_match(0.51)
my_match <- function(df,n){
match_df <- df %>%
rowid_to_column("key")
new_key <- nrow(match_df) + 1
match_df %>%
full_join(
tibble(
key = new_key,
input = n
),
by = c("key","input")
) %>%
arrange(input) %>%
fill(output,.direction = "updown") %>%
filter(key == new_key) %>%
pull(output)
}
df %>%
my_match(0.49)
df %>%
my_match(0.5)
df %>%
my_match(0.8)
df %>%
my_match(0.79)
df %>%
my_match(0.8)
c(0.5, 0.8, 0.9, 0.97, 1)-1
c(0.5, 0.8, 0.9, 0.97, 1)-.01
c(
(c(0.5, 0.8, 0.9, 0.97, 1)-.01),
(c(0.5, 0.8, 0.9, 0.97, 1)+.01)
)
tibble(
new_inputs = c(
(c(0.5, 0.8, 0.9, 0.97, 1)-.01),
(c(0.5, 0.8, 0.9, 0.97, 1)+.01)
)
)
tibble(
new_inputs = c(
(c(0.5, 0.8, 0.9, 0.97, 1)-.01),
(c(0.5, 0.8, 0.9, 0.97, 1)+.01)
)
) %>%
mutate(matched_n = my_match(new_inputs))
my_match <- function(match_tbl,n){
match_df <- match_tbl %>%
rowid_to_column("key")
new_key <- nrow(match_df) + 1
match_df %>%
full_join(
tibble(
key = new_key,
input = n
),
by = c("key","input")
) %>%
arrange(input) %>%
fill(output,.direction = "updown") %>%
filter(key == new_key) %>%
pull(output)
}
my_breaks <- tibble(
input = c(0.5, 0.8, 0.9, 0.97, 1),
output= c(0,1,2,3,4)
)
styler:::style_selection()
tibble(
new_inputs = c(
(c(0.5, 0.8, 0.9, 0.97, 1) - .01),
(c(0.5, 0.8, 0.9, 0.97, 1) + .01)
)
) %>%
mutate(matched_n = my_match(match_tbl,new_inputs))
my_match <- function(match_tbl, n) {
match_df <- match_tbl %>%
rowid_to_column("key")
new_key <- nrow(match_df) + 1
match_df %>%
full_join(
tibble(
key = new_key,
input = n
),
by = c("key", "input")
) %>%
arrange(input) %>%
fill(output, .direction = "updown") %>%
filter(key == new_key) %>%
pull(output)
}
my_breaks <- tibble(
input = c(0.5, 0.8, 0.9, 0.97, 1),
output = c(0, 1, 2, 3, 4)
)
tibble(
new_inputs = c(
(c(0.5, 0.8, 0.9, 0.97, 1) - .01),
(c(0.5, 0.8, 0.9, 0.97, 1) + .01)
)
) %>%
mutate(matched_n = my_match(match_tbl,new_inputs))
tibble(
new_inputs = c(
(c(0.5, 0.8, 0.9, 0.97, 1) - .01),
(c(0.5, 0.8, 0.9, 0.97, 1) + .01)
)
) %>%
mutate(matched_n = my_match(my_breaks,new_inputs))
tibble(
new_inputs = c(
(c(0.5, 0.8, 0.9, 0.97, 1) - .01),
(c(0.5, 0.8, 0.9, 0.97, 1) + .01)
)
) %>%
rowwise() %>%
mutate(matched_n = my_match(my_breaks,new_inputs))
tibble(
new_inputs = c(
(c(0.5, 0.8, 0.9, 0.97, 1) - .01),
(c(0.5, 0.8, 0.9, 0.97, 1) + .01)
)
) %>%
rowwise() %>%
mutate(matched_n = my_match(my_breaks,new_inputs)) %>%
ungroup()
reprex::reprex_selection()
reprex::reprex_selection()
# function ----
my_match <- function(match_tbl, n) {
match_df <- match_tbl %>%
rowid_to_column("key")
new_key <- nrow(match_df) + 1
match_df %>%
full_join(
tibble(
key = new_key,
input = n
),
by = c("key", "input")
) %>%
arrange(input) %>%
fill(output, .direction = "up") %>%
replace_na(list(output = lag(output))) %>%
filter(key == new_key) %>%
pull(output)
}
# break table ----
my_breaks <- tibble(
input = c(0.5, 0.8, 0.9, 0.97, 1),
output = c(0, 1, 2, 3, 4)
)
# test ----
tibble(
new_inputs = c(
(c(0.5, 0.8, 0.9, 0.97, 1) - .01),
(c(0.5, 0.8, 0.9, 0.97, 1) + .01)
)
) %>%
rowwise() %>%
mutate(matched_n = my_match(my_breaks,new_inputs)) %>%
ungroup()
